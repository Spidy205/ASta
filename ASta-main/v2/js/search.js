const ProxyApi=" https://proxy11.sb543267gmailcom.workers.dev/?u=";function getApiServer(){return AvailableServers[Math.floor(Math.random()*AvailableServers.length)]}async function getJson(e,t=0){let a=getApiServer("")+e;if(t>2)throw`Too many errors while fetching ${a}`;t>0&&(console.log("Retrying fetch using proxy"),a=""+a);try{return await (await fetch(a)).json()}catch(s){return console.error(s),getJson(e,t+1)}}async function RefreshLazyLoader(){let e=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){let t=e.target;t.src=t.dataset.src}})});document.querySelectorAll("img.lzy_img").forEach(t=>{e.observe(t)})}function sentenceCase(e){return null!==e&&""!==e&&(e=e.toString()).replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}searchapi="/search/",AvailableServers=["https://asta-api.sb543267gmailcom.workers.dev/","https://vip-gamma.vercel.app/","https://api3.sb543267gmailcom.workers.dev/","https://api100.sb543267gmailcom.workers.dev/","https://api1.sb543267gmailcom.workers.dev/"];let hasNextPage=!0;async function SearchAnime(e,t=1){let a=await getJson("/search/"+e+"?page="+t),s=a.results,r=document.getElementById("latest2"),o=document.getElementById("load"),n="";if(0==s.length)throw"No results found";for(let i=0;i<s.length;i++){let c=s[i];c.title.toLowerCase().includes("dub")?c.subOrDub="DUB":c.subOrDub="SUB",n+=`<a href="./anime.html?anime_id=${c.id}"><div class="poster la-anime"> <div id="shadow1" class="shadow"> <div class="dubb">${c.subOrDub.toUpperCase()}</div></div><div id="shadow2" class="shadow"> <img class="lzy_img" src="staticSpinner@1x-0.2s-200px-200px.svg" data-src="${c.img}"> </div><div class="la-details"> <h3>${sentenceCase(c.title)}</h3> <div id="extra"> <span>${c.releaseDate}</span> </div></div></div></a>`}return r.innerHTML+=n,o.style.display="none",r.style.display="block",a.hasNextPage}const params=new URLSearchParams(window.location.search),query=params.get("query");let page=1;async function loadData(){try{hasNextPage=await SearchAnime(query,page),page+=1,RefreshLazyLoader(),console.log("Search animes loaded")}catch(e){document.getElementById("main-section").style.display="none",document.getElementById("error-page").style.display="block",document.getElementById("error-desc").innerHTML=e,console.error(e)}}null==query&&window.location.replace("./index.html"),document.getElementById("latest").innerHTML=`Search Results: ${query}`,window.addEventListener("scroll",()=>{window.scrollY+window.innerHeight>=document.documentElement.scrollHeight&&!0==hasNextPage&&SearchAnime(query,page).then(e=>{hasNextPage=e,page+=1,RefreshLazyLoader(),console.log("Search animes loaded")})}),loadData();const cache=new Map;function getDataFromAPI(e){if(cache.has(e))return cache.get(e);{let t=fetch(`https://asta-api.sb543267gmailcom.workers.dev/data/${e}`);return cache.set(e,t),t}}const promises=[fetch("https://asta-api.sb543267gmailcom.workers.dev/data/1"),fetch("https://api.example.com/data/2"),fetch("https://api.example.com/data/3")];Promise.all(promises).then(e=>{e.map(e=>e.json())}).catch(e=>{console.error(e)});const db=require("pg"),pool=new db.Pool({user:"admin",host:"localhost",database:"api",password:"root",port:5432});app.get("/",(e,t)=>{pool.connect((e,a,s)=>{e?(console.error(e),t.status(500).send({message:"Error connecting to database"})):a.query("SELECT * FROM users WHERE id = $1",[1],(e,a)=>{s(),e?(console.error(e),t.status(500).send({message:"Error querying database"})):t.json(a.rows)})})}),localStorage.getItem("apiResponse")?JSON.parse(localStorage.getItem("apiResponse")):fetch("https://asta-api.sb543267gmailcom.workers.dev/").then(e=>e.json()).then(e=>{localStorage.setItem("apiResponse",JSON.stringify(e))});const domainsToPrefetch=["https://fonts.googleapis.com","https://fonts.gstatic.com","https://cdn.jsdelivr.net","https://kit.fontawesome.com"];domainsToPrefetch.forEach(e=>{let t=document.createElement("resource");t.href=e,t.rel="prefetch dns-prefetch",document.head.appendChild(t)}); 
    // Make a request to the CORS proxy
    fetch('https://proxy11.sb543267gmailcom.workers.dev/?u=/?u=https://asta-api.sb543267gmailcom.workers.dev/api/data')
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error(error));